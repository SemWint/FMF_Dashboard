import React, { useState, useEffect } from 'react';
import PictureHeatmap from "../Components/PictureHeatmap";
import festivalMap from '../assets/festival_map.jpg';
import Papa from 'papaparse';
import styles from './Dashboard.module.css';
import SimpleNumberWidget from '../Components/SimpleNumberWidget';
import PeakTimeDisplay from '../Components/PeakTimeDisplay';
import LowTimeDisplay from '../Components/LowTimeDisplay';
import TimeRangeSlider from '../Components/TimeRangeSlider';
import DatePickerCustom from '../Components/DatePickerCustom';
import { useNavigate } from 'react-router-dom';

function Dashboard() {
    const navigate = useNavigate();
    const [range, setRange] = useState({ startMinutes: 8 * 60, endMinutes: 18 * 60 });
    const [locationData, setLocationData] = useState([]);
    const [date, setDate] = useState("2026-01-19");

    useEffect(() => {
        // Fetch CSV file from your assets or API
        fetch('../../data/output.csv') // or import it: import csvFile from '../assets/data.csv'
        .then(response => response.text())
        .then(csvText => {
            Papa.parse(csvText, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: (results) => {
                const data = results.data.map(row => ({
                latitude: row.lat,
                longitude: row.lng,
                intensity: row.intensity || 0.1
                }));
                setLocationData(data);
            }
            });
        })
        .catch(error => console.error('Error loading CSV:', error));
    }, []);

    return (
        <>
            <button onClick={() => navigate("/")}>
                Go To Home Page
            </button>
            <div className={styles.dashcontainer}>
                <div className={styles.horizontalWidgetContainer}>
                    <a>Festival density heatmap</a>
                
                    <PictureHeatmap
                        imageUrl={festivalMap}
                        imageWidth={1200}
                        imageHeight={800}
                        data={locationData}
                        imageBounds={{
                            north: 52.1354,
                            south: 52.1325,
                            east: 5.1462,
                            west: 5.1415
                        }}
                        radius={40}
                        blur={20}
                        opacity={0.6}
                        maxDisplaySize={800}
                        showControls={false}
                    />
                    <TimeRangeSlider
                            label="Select Time Range"
                            stepMinutes={15}
                            value={range}
                            onChange={setRange}
                            format="24h"
                    />
                    <DatePickerCustom
                        label="Select a date"
                        value={date}
                        onChange={setDate}
                        min="2025-01-01"
                        max="2027-12-31"
                        helperText="Pick any date in range."
                    />
                </div>
                <div className={styles.horizontalContainer}>
                    <SimpleNumberWidget title="Total Attendees" number={1250} trend="up" />
                    <SimpleNumberWidget title="Female" number={497} trend="neutral" />
                    <SimpleNumberWidget title="Male" number={678} trend="up" />
                    <SimpleNumberWidget title="Other" number={75} trend="down" />
                </div>
                <SimpleNumberWidget title="Amount of friends found" number={178} trend="up" />
                <div className={styles.horizontalContainer}>
                    <PeakTimeDisplay arrivals={getTimeData()} />
                    <LowTimeDisplay arrivals={getTimeData()} />
                </div>
                <SimpleNumberWidget title="Active FMF's" number={968} trend="up" />
                
            </div>
        </>
    );
}

function getTimeData() {
    // Placeholder function to simulate fetching time data
    return [
        { time: "09:00" },
        { time: "09:00" },
        { time: "10:00" },
        { time: "09:00" },
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "10:00" },
        { time: "09:00" },
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "09:00" },
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" },
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" },         
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
        { time: "11:00" },
        { time: "10:00" },
        { time: "12:00" }, 
    ];
}

export default Dashboard;